<style>
    .posts-table-container {
        overflow-x: auto;
        width: 100vw;
        max-width: 100vw;
    }

    .posts-table {
        width: 100%;
        min-width: 420px;
        border-collapse: collapse;
        border: none;
        table-layout: fixed;
    }

        .posts-table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border: none;
            text-align: left;
        }

        .posts-table a {
            max-width: 160px;
            display: inline-block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }

    @media (max-width: 600px) {
        .posts-table a {
            max-width: 100px;
        }

        .posts-table {
            min-width: 340px;
        }
    }
</style>
<script>
    function loadAllPosts(feedNames, rootId) {
        const fetchPromises = feedNames.map(name =>
            fetch(`/dev-links/posts/${name}.json`, { cache: 'no-store' })
                .then(response => response.json())
                .then(items => items.map(item => ({ ...item, feed: name })))
                .catch(() => [])
        );

        Promise.all(fetchPromises)
            .then(allResults => {
                const allItems = allResults.flat();

                // Sort by pubDate (descending)
                allItems.sort((a, b) => {
                    const aDate = new Date(a.pubDate);
                    const bDate = new Date(b.pubDate);
                    return bDate - aDate;
                });

                // Limit to first 50 posts only
                const limitedItems = allItems.slice(0, 50);

                const root = document.getElementById(rootId);
                if (!root) return;

                root.innerHTML = '';

                // Create scrollable container for mobile
                const container = document.createElement('div');
                container.className = 'posts-table-container';
                container.style.overflowX = 'auto';
                container.style.width = '100vw';
                container.style.maxWidth = '100vw';

                // Create table (no header, no borders, max width, fixed layout)
                const table = document.createElement('table');
                table.className = 'posts-table';
                table.style.width = '100%';
                table.style.maxWidth = '100vw';
                table.style.borderCollapse = 'collapse';
                table.style.border = 'none';
                table.style.tableLayout = 'fixed';
                table.style.minWidth = '420px';

                const tbody = document.createElement('tbody');

                limitedItems.forEach(item => {
                    // Format date
                    let dateStr = '';
                    if (item.pubDate) {
                        const dateObj = new Date(item.pubDate);
                        if (!isNaN(dateObj)) {
                            const yyyy = dateObj.getFullYear();
                            const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const dd = String(dateObj.getDate()).padStart(2, '0');
                            dateStr = `${yyyy}-${mm}-${dd}`;
                        }
                    }

                    // Favico switch-case
                    let iconName;
                    switch (item.feed) {
                        case 'dotnet':
                        case 'visualstudio':
                            iconName = 'microsoft';
                            break;
                        case 'davecallan':
                        case 'jonskeet':
                            iconName = 'wp';
                            break;
                        case 'bartwullems':
                            iconName = 'blogspot';
                            break;
                        case 'adamsitnik':
                        case 'antirez':
                        case 'erikej':
                        case 'microservices':
                        case 'paulhammant':
                            iconName = 'blank';
                            break;
                        default:
                            iconName = item.feed;
                    }

                    const tr = document.createElement('tr');
                    tr.style.border = 'none';

                    // Favico cell
                    const tdIcon = document.createElement('td');
                    const img = document.createElement('img');
                    img.src = `/dev-links/favicons/${iconName}.png`;
                    img.alt = 'icon';
                    img.style.width = '16px';
                    img.style.height = '16px';
                    img.style.verticalAlign = 'middle';
                    tdIcon.appendChild(img);
                    tdIcon.style.textAlign = 'left';
                    tdIcon.style.padding = '4px 8px 4px 0';
                    tdIcon.style.border = 'none';
                    tdIcon.style.width = '28px';
                    tdIcon.style.whiteSpace = 'nowrap';
                    tr.appendChild(tdIcon);

                    // Date cell
                    const tdDate = document.createElement('td');
                    tdDate.textContent = dateStr;
                    tdDate.style.padding = '4px 8px 4px 0';
                    tdDate.style.textAlign = 'left';
                    tdDate.style.border = 'none';
                    tdDate.style.width = '90px';
                    tdDate.style.whiteSpace = 'nowrap';
                    tdDate.style.overflow = 'hidden';
                    tdDate.style.textOverflow = 'ellipsis';
                    tr.appendChild(tdDate);

                    // Feed cell
                    const tdFeed = document.createElement('td');
                    tdFeed.textContent = item.feed;
                    tdFeed.style.padding = '4px 8px 4px 0';
                    tdFeed.style.textAlign = 'left';
                    tdFeed.style.border = 'none';
                    tdFeed.style.width = '90px';
                    tdFeed.style.whiteSpace = 'nowrap';
                    tdFeed.style.overflow = 'hidden';
                    tdFeed.style.textOverflow = 'ellipsis';
                    tr.appendChild(tdFeed);

                    // Title cell (with ellipsis if overflowing)
                    const tdTitle = document.createElement('td');
                    const a = document.createElement('a');
                    a.href = item.link;
                    a.textContent = item.title;
                    a.target = '_blank';
                    a.rel = 'noopener noreferrer';
                    a.style.whiteSpace = 'nowrap';
                    a.style.overflow = 'hidden';
                    a.style.textOverflow = 'ellipsis';
                    a.style.maxWidth = '160px';
                    a.style.display = 'inline-block';
                    tdTitle.appendChild(a);
                    tdTitle.style.padding = '4px 0 4px 0';
                    tdTitle.style.textAlign = 'left';
                    tdTitle.style.border = 'none';
                    tdTitle.style.width = '100%';
                    tdTitle.style.whiteSpace = 'nowrap';
                    tdTitle.style.overflow = 'hidden';
                    tdTitle.style.textOverflow = 'ellipsis';
                    tr.appendChild(tdTitle);

                    tbody.appendChild(tr);
                });

                table.appendChild(tbody);
                container.appendChild(table);
                root.appendChild(container);
            })
            .catch(error => {
                console.error('Failed to load all posts:', error);
            });
    }
    document.addEventListener('DOMContentLoaded', () => {
        loadAllPosts([
              'dotnet'
            , 'visualstudio'
            , 'visualstudiomagazine'

            , 'microservices'
            , 'developertoarchitect'

            , 'ardalis'
            , 'hanselman'
            , 'andrewlock'
            , 'davecallan'
            , 'stephencleary'
            , 'jonskeet'
            , 'jimmybogard'
            , 'devlead'
            , 'steven-giesel'
            , 'adamsitnik'
            , 'minidump'
            , 'mattwarren'
            , 'haacked'
            , 'erikej'
            , 'enterprisecraftsmanship'

            , 'antirez'
            , 'simonwillison'
            , 'nickcraver'
            , 'codinghorror'
            , 'joelonsoftware'
            , 'neilonsoftware'
            , 'brendangregg'
            , 'paulhammant'
            , 'sizovs'
            , 'bartwullems'
            , 'pragmaticengineer'
            , 'vadimkravcenko'
            , 'thecodist'

            , 'terriblesoftware'
            , 'lethain'
            , 'effectiveengineer'
        ], 'reader');
    });
</script>
