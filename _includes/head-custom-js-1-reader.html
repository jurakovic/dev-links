<script>
    function loadAllPosts(feedNames, rootId) {
        const fetchPromises = feedNames.map(name =>
            fetch(`/dev-links/posts/${name}.json`, { cache: 'no-store' })
                .then(response => response.json())
                .then(items => items.map(item => ({ ...item, feed: name })))
                .catch(() => [])
        );

        Promise.all(fetchPromises)
            .then(allResults => {
                const allItems = allResults.flat();

                // Sort by pubDate (descending)
                allItems.sort((a, b) => {
                    const aDate = new Date(a.pubDate);
                    const bDate = new Date(b.pubDate);
                    return bDate - aDate;
                });

                // Limit to first 50 posts only
                const limitedItems = allItems.slice(0, 50);

                const root = document.getElementById(rootId);
                if (!root) return;

                root.innerHTML = '';

                // Make a horizontally scrollable container
                const container = document.createElement('div');
                container.style.overflowX = 'auto';
                container.style.width = '100%';

                // Create table (no header, no borders, no wrapping anywhere, fixed layout)
                const table = document.createElement('table');
                table.style.width = 'max-content';
                table.style.borderCollapse = 'collapse';
                table.style.border = 'none';
                table.style.tableLayout = 'fixed';

                const tbody = document.createElement('tbody');

                limitedItems.forEach(item => {
                    // Format date
                    let dateStr = '';
                    if (item.pubDate) {
                        const dateObj = new Date(item.pubDate);
                        if (!isNaN(dateObj)) {
                            const yyyy = dateObj.getFullYear();
                            const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const dd = String(dateObj.getDate()).padStart(2, '0');
                            dateStr = `${yyyy}-${mm}-${dd}`;
                        }
                    }

                    // Favico switch-case
                    let iconName;
                    switch (item.feed) {
                        case 'dotnet':
                        case 'visualstudio':
                            iconName = 'microsoft';
                            break;
                        case 'davecallan':
                        case 'jonskeet':
                            iconName = 'wp';
                            break;
                        case 'bartwullems':
                            iconName = 'blogspot';
                            break;
                        case 'adamsitnik':
                        case 'antirez':
                        case 'erikej':
                        case 'microservices':
                        case 'paulhammant':
                            iconName = 'blank';
                            break;
                        default:
                            iconName = item.feed;
                    }

                    const tr = document.createElement('tr');
                    tr.style.border = 'none';

                    // Favico cell
                    const tdIcon = document.createElement('td');
                    const img = document.createElement('img');
                    img.src = `/dev-links/favicons/${iconName}.png`;
                    img.alt = 'icon';
                    img.style.width = '16px';
                    img.style.height = '16px';
                    img.style.verticalAlign = 'middle';
                    tdIcon.appendChild(img);
                    tdIcon.style.textAlign = 'left';
                    tdIcon.style.padding = '2px 8px 2px 0';
                    tdIcon.style.border = 'none';
                    tdIcon.style.whiteSpace = 'nowrap';
                    tdIcon.style.overflow = 'hidden';
                    tr.appendChild(tdIcon);

                    // Date cell
                    const tdDate = document.createElement('td');
                    tdDate.textContent = dateStr;
                    tdDate.style.padding = '2px 8px 2px 0';
                    tdDate.style.textAlign = 'left';
                    tdDate.style.border = 'none';
                    tdDate.style.whiteSpace = 'nowrap';
                    tdDate.style.overflow = 'hidden';
                    tr.appendChild(tdDate);

                    // Feed cell
                    const tdFeed = document.createElement('td');
                    tdFeed.textContent = item.feed;
                    tdFeed.style.padding = '2px 8px 2px 0';
                    tdFeed.style.textAlign = 'left';
                    tdFeed.style.border = 'none';
                    tdFeed.style.whiteSpace = 'nowrap';
                    tdFeed.style.overflow = 'hidden';
                    tr.appendChild(tdFeed);

                    // Title cell (with ellipsis if overflowing)
                    const tdTitle = document.createElement('td');
                    const a = document.createElement('a');
                    a.href = item.link;
                    a.textContent = item.title;
                    a.target = '_blank';
                    a.rel = 'noopener noreferrer';
                    a.style.whiteSpace = 'nowrap';
                    a.style.overflow = 'hidden';
                    a.style.textOverflow = 'ellipsis';
                    a.style.display = 'inline-block';
                    a.style.maxWidth = '500px';
                    tdTitle.appendChild(a);
                    tdTitle.style.padding = '2px 0 2px 0';
                    tdTitle.style.textAlign = 'left';
                    tdTitle.style.border = 'none';
                    tdTitle.style.whiteSpace = 'nowrap';
                    tdTitle.style.overflow = 'hidden';
                    tdTitle.style.maxWidth = '500px';
                    tr.appendChild(tdTitle);

                    tbody.appendChild(tr);
                });

                table.appendChild(tbody);
                container.appendChild(table);
                root.appendChild(container);
            })
            .catch(error => {
                console.error('Failed to load all posts:', error);
            });
    }
    document.addEventListener('DOMContentLoaded', () => {
        loadAllPosts([
              'dotnet'
            , 'visualstudio'
            , 'visualstudiomagazine'

            , 'microservices'
            , 'developertoarchitect'

            , 'ardalis'
            , 'hanselman'
            , 'andrewlock'
            , 'davecallan'
            , 'stephencleary'
            , 'jonskeet'
            , 'jimmybogard'
            , 'devlead'
            , 'steven-giesel'
            , 'adamsitnik'
            , 'minidump'
            , 'mattwarren'
            , 'haacked'
            , 'erikej'
            , 'enterprisecraftsmanship'

            , 'antirez'
            , 'simonwillison'
            , 'nickcraver'
            , 'codinghorror'
            , 'joelonsoftware'
            , 'neilonsoftware'
            , 'brendangregg'
            , 'paulhammant'
            , 'sizovs'
            , 'bartwullems'
            , 'pragmaticengineer'
            , 'vadimkravcenko'
            , 'thecodist'

            , 'terriblesoftware'
            , 'lethain'
            , 'effectiveengineer'
        ], 'reader');
    });
</script>
